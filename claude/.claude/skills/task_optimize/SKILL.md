---
name: task_optimize
description: Planエージェントが立案した計画を、最適な粒度のタスクに分解して出力する。
allowed-tools: Read, Grep, Glob
---

## 目的

Planエージェントが計画を立案した直後にのみ実行すること。「独立して実行可能」かつ「適切な粒度」を持つタスクへと計画を細分化する責任を持つ。

## ガイドライン

### 言語規定
- **日本語出力の徹底**: 生成されるすべてのコンテンツ（タスク名、説明、および `todo.md` への記載内容）は、必ず**日本語**で記述すること。

### タスクの粒度

- **機能的凝集性**: タスクは機能的に意味のある単位で分割すること。
  - 各タスクが自己完結しており、独立してテストおよび完了ができることを確認すること。
  - 分解したタスクは `./agent_docs/todo.md` に記録し、機能セクションごとに整理すること。
  - **例**: Userテーブルへのカラム追加とプロフィールUIの更新
    - 分解例: [データベーススキーマの更新], [APIの実装], [UIの調整], [クライアントサイドのAPI連携]
- **レイヤーベースの順序付け**: 低レイヤー（インフラ/データ）から高レイヤー（プレゼンテーション/UI）の順にタスクを並べること。
  - **順序**: DBスキーマ → APIロジック → クライアントサイドロジック → UIコンポーネント

### 変更スコープの制限

- **LOCの事前計算**: タスクを開始する前に、変更される総行数（LOC）を予測すること。
- **5ファイルルール**: 変更予測が **200行** を超える場合、タスクの規模にかかわらず、1タスクあたりの変更範囲は **最大5ファイル** までに制限すること。
- **再分解の検討**: タスクが上記の制限を超える場合は、さらに小さなサブタスクへの細分化（Granularization）を検討すること。

## 禁止事項

- **基準以下のタスク分解**: 以下のようなタスク分割を厳禁とする。
  - 機能的な意味をなさない恣意的な分割。
  - テーブルに追加するカラム1つごとに個別のタスクを作成するような、過度な細分化。
  - 単体で検証できず、独立して動作しない不完全な単位。
- **完了なきタスク連鎖**: 現在のタスクを正式に終了・確認報告することなく、次のタスクへ進んだり、アクションを「連鎖（チェイニング）」させたりすること。
